[workspace]
name = "cryoswath"
description = "CryoSwath environment using pixi"
channels = ["conda-forge"]
platforms = ["linux-64"]

[dependencies]
python = "3.11.*"
pip = "*"
bottleneck = "*"
dask = "*"
defusedxml = "*"
geopandas = ">=1.0.1"
gitpython = "*"
h5netcdf = "*"
h5py = "*"
matplotlib = "*"
numpy = "*"
packaging = "*"
pandas = "*"
pyarrow = "*"
pyogrio = "*"
pyproj = "*"
pystac-client = "*"
pytables = "*"
python-dateutil = "*"
rasterio = "*"
rioxarray = "*"
scikit-learn = "*"
scipy = "*"
shapely = "*"
stackstac = "*"
statsmodels = "*"
tqdm = "*"
xarray = ">=2025.3,<2025.12"
xpystac = ">=0.4,<0.5"
zarr = "*"

[pypi-dependencies]
# Keep local source editable, but resolve the runtime stack via Conda below.
cryoswath = { path = ".", editable = true }

[feature.test]
channels = ["conda-forge", "bioconda", "nodefaults"]

[feature.test.dependencies]
distributed = "*"
ipykernel = "*"
nbconvert = "*"
papermill = "*"
snakemake = "*"
pytest = "*"
tox = "*"

[feature.docs]
channels = ["conda-forge", "nodefaults"]

[feature.docs.dependencies]
sphinx = "*"
pydata-sphinx-theme = "*"

[feature.docs.tasks]
docs-build = "python -m sphinx -b html docs docs/_build/html"
docs-build-strict = "python -m sphinx -W -b html docs docs/_build/html"

[feature.test.tasks]
test-unit = "pytest -q tests/test_l1b.py"

[feature.test.tasks.test-notebooks]
cmd = "snakemake --snakefile Snakefile --cores 1 --use-conda"
cwd = "tests/reports"
env = { PYTHONPATH = "$PIXI_PROJECT_ROOT" }

[feature.test.tasks.test-tutorial-notebooks]
args = [{ arg = "tutorial_dir", default = "$PIXI_PROJECT_ROOT/scripts" }]
cmd = "snakemake --directory \"{{ tutorial_dir }}\" --snakefile \"$PIXI_PROJECT_ROOT/tests/tutorials/Snakefile\" --cores 1 --use-conda"
env = { PYTHONPATH = "$PIXI_PROJECT_ROOT" }

[feature.test.tasks.test-all]
args = [{ arg = "tutorial_dir", default = "$PIXI_PROJECT_ROOT/scripts" }]
depends-on = [
  "test-unit",
  "test-notebooks",
  { task = "test-tutorial-notebooks", args = ["{{ tutorial_dir }}"] },
]

[tasks]
sync-test-feature = "pixi import --format conda-env --feature test --environment test environment.yml"

[environments]
default = { features = [], solve-group = "runtime" }
test = { features = ["test"], solve-group = "runtime" }
docs = { features = ["docs"], solve-group = "docs" }
